<!--
  Generated template for the MyCustomerPage page.

  See http://ionicframework.com/docs/components/#navigation for more info on
  Ionic pages and navigation.
-->
<ion-header no-border>

  <ion-navbar color="primary">
    <ion-title>我的客户</ion-title>
    <ion-buttons end>
      <button ion-button class="limit-width" text-wrap (click)="selectProject();">{{currentProject.name || '选择项目'}} <ion-icon name="md-arrow-dropdown"></ion-icon></button>
    </ion-buttons>
  </ion-navbar>
  <ion-toolbar color="white">
    <ion-segment [(ngModel)]="menuType" 
      mode="md"
      
      (ionChange)="segmentChanged($event)">
      <ion-segment-button value="{{menu.ID}}" *ngFor="let menu of menues">
        {{menu.name}}
      </ion-segment-button>
    </ion-segment>
  </ion-toolbar>
  <ion-toolbar color="white" *ngIf="!showPanel">
      <!-- <ion-searchbar placeholder="搜索"></ion-searchbar> -->
      <form action=".">
        <ion-searchbar
          #searchBar
          [(ngModel)]="keyword"
          cancelButtonText="取消"
          [ngModelOptions]="{standalone: true}"
          [showCancelButton]="true"
          (search)="startSearch(keyword)"
          placeholder="搜索"
          [animated]="false"
          name="search"
        >
        </ion-searchbar>
    </form>
    </ion-toolbar>
</ion-header>

<ion-content>
  <div class="empty-error-box" *ngIf="!!error">
    {{error}}
  </div>
  <ion-refresher (ionRefresh)="doRefresh($event)">
    <ion-refresher-content
      pullingIcon="ios-arrow-round-down-outline"
      pullingText="下拉刷新"
      refreshingSpinner="circles" 
      refreshingText="正在刷新">
    </ion-refresher-content>
  </ion-refresher>
  <ion-list>
    <div *ngFor="let item of data" class="custom-card" tappable (click)="openItem(item);">
      <!-- <ion-item tappable (click)="selectItem(item);" *ngIf="menuType == '1'">
        <h2 text-wrap class="title">
          {{item.telephone | hackMobile}}&nbsp;{{item.custname}}
          <ion-icon 
            [class.male]="item.sex == '1' || item.sex == '男'" 
            [class.female]="item.sex == '2' || item.sex == '女'" 
            name="{{item.sex == '1' || item.sex == '男' ? 'ios-male-outline' : 'ios-female-outline'}}">
          </ion-icon>
        </h2>
        <p text-wrap>上次跟进内容: {{item.content}}</p>
        <p>上次跟进时间: {{item.lastfollowdate | formatDate:'1'}}</p>
        <div item-right class="right-section">
          <p>跟进<span class="days">{{item.followcnt}}</span>次</p>
          <button ion-button clear (click)="callPhone(item, $event);"><ion-icon name="ios-call-outline"></ion-icon></button>
          <p class="left-days-warning" *ngIf="item.invaliddate && item.invaliddate !== 'NULL'">
            <span *ngIf="item.left_days !== 0">{{item.left_days_label}}{{item.left_days}}天</span>
            <span *ngIf="item.left_days === 0">即将过期</span>
          </p>
        </div>
        
      </ion-item> -->
      <man-item *ngIf="menuType == '1'" 
        [item]="item" 
        (onSelect)="selectItem(item);"
        (onCallPhone)="callPhone(item);"></man-item>

      <ion-item tappable (click)="selectItem(item);" *ngIf="menuType == '6'">
        <h2 text-wrap class="title">
          {{item.telephone}} {{item.custname}} 
          <ion-icon 
            [class.male]="item.sex == '1' || item.sex == '男'" 
            [class.female]="item.sex == '2' || item.sex == '女'" 
            name="{{item.sex == '1' || item.sex == '男' ? 'ios-male-outline' : 'ios-female-outline'}}">
          </ion-icon>
        </h2>
        <p>房号: {{item.house_no}}</p>
        <p text-wrap>{{item.abnormalsubname}}</p>
        <ion-badge item-right class="custom-badge" color="reply-{{item.is_reply}}">{{item.is_reply == '0' ? '未回复' : '已回复'}}</ion-badge>
      </ion-item>

      <ion-item *ngIf="menuType === '2' || menuType === '3'">
        <ion-row>
          <ion-col col-4>
            <div class="left cell-box">
              <p class="custname">{{item.custnames}}</p>
              <p class="hor-item"><span class="label-text">客户来源</span><span class="value-text">{{item.sourcetype}}</span></p>
              <p class="ver-item" *ngIf="menuType === '2'">
                <span class="label-text">认购日期</span><br>
                <span class="value-text">{{item.orderdate.split('T')[0]}}</span>
              </p>
            </div>
          </ion-col>
          <ion-col col-4>
            <div class="center cell-box">
              <p class="house-info"><span class="outusertypename type-color-{{item.outusertypeid}}">{{item.outusertypename}}</span><span class="house-no">{{item.house_no}}</span></p>
              <p class="hor-item"><span class="label-text">置业顾问</span><span class="value-text">{{item.sellername}}</span></p>
              <p class="ver-item" *ngIf="menuType === '2'">
                <span class="label-text">签约失效日期</span><br>
                <span class="value-text">{{item.plancondate.split('T')[0]}}</span>
              </p>
            </div>
          </ion-col>
          <ion-col col-4>
            <div class="right cell-box">
              <p class="money">{{formatMoney(item.money)}}<span class="unit">万</span></p>
              <span class="call-btn" *ngIf="menuType === '2'" tappable (click)="callPhone(item, $event);"><ion-icon name="ios-call-outline"></ion-icon></span>
              <p class="con-date" *ngIf="menuType === '3'">{{item.condate.split('T')[0]}}<span class="help-text">签约</span></p>
              <p class="left-days-warning" *ngIf="menuType === '2'">
                <span *ngIf="item.left_days !== 0">{{item.left_days_label}}{{item.left_days}}天</span>
                <span *ngIf="item.left_days === 0">即将过期</span>
              </p>
            </div>
          </ion-col>
        </ion-row>
      </ion-item>
    </div>
  </ion-list>
</ion-content>
